apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: vh-scheduler-jobs
  namespace: vh
spec:
  releaseName: vh-scheduler-jobs
  values:
    image: sdshmctspublic.azurecr.io/vh/scheduler-jobs-sds:prod-41cb868-202302281029 #{"$imagepolicy": "flux-system:vh-scheduler-jobs-prod"}
    crons:
      - cronJobName: vh-anonymise-hearings-and-conferences-job
        suspend: true
        schedule: "30 5 * * *"
        concurrencyPolicy: Forbid
        args:
          - AnonymiseHearingsConferencesAndDeleteAadUsersJob
      - cronJobName: vh-clear-conference-message-history-job
        suspend: true
        schedule: "0 * * * *"
        concurrencyPolicy: Forbid
        args:
          - ClearConferenceInstantMessageHistoryJob
      - cronJobName: vh-clear-hearings-job
        suspend: true
        schedule: "0 23 * * *"
        concurrencyPolicy: Forbid
        args:
          - ClearHearingsJob
      - cronJobName: vh-delete-audio-recording-applications-job
        suspend: true
        schedule: "0 22 * * *"
        concurrencyPolicy: Forbid
        args:
          - DeleteAudioRecordingApplicationsJob
      - cronJobName: vh-get-judiciary-users-job
        suspend: true
        schedule: "0 2 * * *"
        concurrencyPolicy: Forbid
        args:
          - GetJudiciaryUsersJob
      - cronJobName: vh-reconcile-hearing-audio-with-storage-job
        suspend: true
        schedule: "0 22 * * *"
        concurrencyPolicy: Forbid
        args:
          - ReconcileHearingAudioWithStorageJob
      - cronJobName: vh-remove-heartbeats-for-conferences-job
        suspend: true
        schedule: "40 5 * * *"
        concurrencyPolicy: Forbid
        args:
          - RemoveHeartbeatsForConferencesJob
      - cronJobName: vh-send-hearing-notifications-job
        suspend: true
        schedule: "0 10 * * *"
        concurrencyPolicy: Forbid
        args:
          - SendHearingNotificationsJob
      - cronJobName: vh-hearing-allocations-job
        suspend: true
        schedule: "0 3 * * *"
        concurrencyPolicy: Forbid
        args:
          - HearingsAllocationJob
  chart:
    spec:
      chart: ./stable/vh-scheduler-jobs/prod
