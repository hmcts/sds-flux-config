apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: hmi-rota-dtu
spec:
  values:
    function:
      image: sdshmctspublic.azurecr.io/hmi/rota-dtu:pr-30-9d53c5b-20230417110748
      aadIdentityName: hmi
      keyVaults:
        hmi-kv:
          excludeEnvironmentSuffix: false
          resourceGroup: hmi-sharedinfra-{{ .Values.global.environment }}-rg
          usePodIdentity: true
          secrets:
            - name: sa-connection-string
              alias: CONNECTION_STRING
            - name: poc-url
              alias: URL
      scaleType: Job
      triggerAuth:
        create: true
        enabled: true
        triggerPodIdentityProvider: "azure"
      triggers:
        - type: azure-blob
          blobContainerName: rota
          blobCount: 1
          accountName: "hmisa{{ .Values.global.environment }}"
          blobDelimiter: "/"
