apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: toffee-frontend
  namespace: toffee
spec:
  chart:
    spec:
      chart: toffee-frontend
      version: 0.1.38
      sourceRef:
        kind: HelmRepository
        name: hmctssbox-oci
        namespace: flux-system
  values:
    nodejs:
      image: hmctssbox.azurecr.io/toffee/frontend:prod-8775362-20250225094245 #{"$imagepolicy": "flux-system:toffee-frontend-sbox"}
      ingressHost: toffee.sandbox.platform.hmcts.net
      environment:
        RECIPE_BACKEND_URL: http://toffee-recipe-backend.sandbox.platform.hmcts.net
      useWorkloadIdentity: true
      workloadClientID: ${WORKLOAD_IDENTITY_ID}
    global:
      environment: sandbox
    volumes:
      - name: azurekeyvault
        csi:
          driver: secrets-store.csi.k8s.io
          readOnly: true
          volumeAttributes:
            secretProviderClass: "default-cert"
