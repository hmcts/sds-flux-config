apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: libragob-batch-housekeeping
  namespace: met
spec:
  releaseName: libragob-batch-housekeeping
  values:
    kind: CronJob
    image: hmctspublic.azurecr.io/libragob/housekeeping:prod-c43a768f-1730894947 #{"$imagepolicy": "flux-system:libragob-batch-housekeeping"}
    schedule: "0 19 * * *"
    suspend: true
    keyVaults:
      libragob-test-kv:
        excludeEnvironmentSuffix: true
        secrets:
          - event-datasource-username
          - event-datasource-password
          - event-datasource-url
          - themis-gateway-dbusername
          - themis-gateway-dbpassword
          - themis-gateway-datasourceurl
          - dac-datasource-username
          - dac-datasource-password
          - dac-datasource-url
    environment:
      KV_NAME: libragob-test-kv
  chart:
    spec:
      chart: job
      sourceRef:
        kind: GitRepository
        name: chart-job
        namespace: flux-system
      interval: 1m
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: libragob-batch-ams-reporting
  namespace: met
spec:
  releaseName: libragob-batch-ams-reporting
  values:
    kind: CronJob
    image: hmctspublic.azurecr.io/libragob/ams-reporting:prod-f4ca186a-1730895375 #{"$imagepolicy": "flux-system:libragob-batch-ams-reporting"}
    schedule: "*/3 * * * *"
    suspend: false
    keyVaults:
      libragob-test-kv:
        excludeEnvironmentSuffix: true
        secrets:
          - event-datasource-username
          - event-datasource-password
          - event-datasource-url
          - themis-gateway-dbusername
          - themis-gateway-dbpassword
          - themis-gateway-datasourceurl
          - dac-datasource-username
          - dac-datasource-password
          - dac-datasource-url
          - fines-datasource-password
          - fines-datasource-username
          - fines-datasource-url
          - maintenance-datasource-password
          - maintenance-datasource-username
          - maintenance-datasource-url
          - confiscation-datasource-password
          - confiscation-datasource-username
          - confiscation-datasource-url
          - postgres-datasource-username
          - postgres-datasource-password
          - postgres-datasource-url
          - sftp-username
          - sftp-endpoint
          - sftp-pvt-key
    environment:
      KV_NAME: libragob-test-kv
      DUMMY_VAR_TO_RESTART: 0
  chart:
    spec:
      chart: job
      sourceRef:
        kind: GitRepository
        name: chart-job
        namespace: flux-system
      interval: 1m
