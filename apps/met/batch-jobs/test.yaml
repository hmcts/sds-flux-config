apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: libragob-batch-housekeeping
  namespace: met
spec:
  releaseName: libragob-batch-housekeeping
  values:
    kind: CronJob
    image: hmctspublic.azurecr.io/libragob/housekeeping:prod-3d858ccf-1710272860 #{"$imagepolicy": "flux-system:libragob-batch-housekeeping"}
    schedule: "52 19 12 3 *"
    suspend: false
    keyVaults:
      libragob-test-kv:
        excludeEnvironmentSuffix: true
        secrets:
          - event-datasource-username
          - event-datasource-password
          - event-datasource-url
          - themis-gateway-dbusername
          - themis-gateway-dbpassword
          - themis-gateway-datasourceurl
          - libragob-pg-admin-password
    environment:
      KV_NAME: libragob-test-kv
    backoffLimit: 1
  chart:
    spec:
      chart: job
      sourceRef:
        kind: GitRepository
        name: chart-job
        namespace: flux-system
      interval: 1m
