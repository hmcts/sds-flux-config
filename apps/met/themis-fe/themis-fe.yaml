---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: themis-fe
  namespace: met
spec:
  interval: 5m
  releaseName: met-themis-fe
  values:
    podLabels:
      aadpodidbinding: met-schema-binding
    nodejs:
      applicationPort: 8082
      livenessDelay: 90
      startupDelay: 90
      readinessPath: /services/themisgatewayapi?wsdl
      startupPath: /services/themisgatewayapi?wsdl
      livenessPath: /services/themisgatewayapi?wsdl
      replicas: 4
      memoryRequests: "128Mi"
      cpuRequests: "50m"
      memoryLimits: "1024Mi"
      cpuLimits: "1000m"
      autoscaling:
        enabled: true
        maxReplicas: 8
        targetCPUUtilizationPercentage: 80
      environment:
        THEMIS_GATEWAY_LISTENERSENDERID: Themis_DAC
        THEMIS_GATEWAY_WRITERSENDERID: Themis_GW
        THEMIS_GATEWAY_PERSISTMESSAGEAUDITCONTENTFORNONUIFLOW: true
        THEMIS_GATEWAY_RESPONSESMAXCONCURRENTPROCESSED: 20
        THEMIS_GATEWAY_CONNECTIONTIMEOUT: 720000
        THEMIS_GATEWAY_RECEIVETIMEOUT: 720000
        THEMIS_GATEWAY_MESSAGEAUDITSUPPRESSION: OFF
        THEMIS_GATEWAY_WRITERQUEUENAME: LIBRAGOB_WRITERQUEUE
        THEMIS_GATEWAY_LISTENERQUEUENAME: LIBRAGOB_READERQUEUE
        THEMIS_GATEWAY_HOLDERCLEANUPCRON: 0 0,30 * * * ?
        THEMIS_GATEWAY_JKSLOCATION: /opt/jks/ThemisAzureKeyStore.jks
        DAC_KEY_EXPIRE_TIME_SECONDS: 1800
        DAC_NUMBER_OF_INSTANCES: 5
        CONFISCATION_SCHEMAS: 110,45,97,116,66,109
        MAINTENANCE_SCHEMAS: 111,67,44
        THEMIS_DAC_LISTENERSENDERID: Themis_GW
        THEMIS_DAC_LISTENERQUEUENAME: LIBRAGOB_WRITERQUEUE
        THEMIS_DAC_WRITERQUEUENAME: LIBRAGOB_READERQUEUE
        SPRING_JMS_SERVICEBUS_IDLE-timeout: 30000
        UPDATES_FIXEDRATE_IN_MILLISECONDS: 2000
        updates_fixedRate_in_milliseconds: 2000
        SPRING_JMS_SERVICEBUS_PRICING-TIER: PREMIUM
        logging_level_root: ERROR
        LOGGING_LEVEL_ROOT: ERROR
  chart:
    spec:
      chart: ./charts/met
      sourceRef:
        kind: GitRepository
        name: sds-helm-charts
        namespace: flux-system
      interval: 1m
