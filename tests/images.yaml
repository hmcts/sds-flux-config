apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-admin-web
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-admin-web/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-admin-web
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      environment:
        AZUREAD__POSTLOGOUTREDIRECTURI: https://admin.hearings.reform.hmcts.net/logout
        AZUREAD__REDIRECTURI: https://admin.hearings.reform.hmcts.net/home
        DOM1__POSTLOGOUTREDIRECTURI: https://admin.hearings.reform.hmcts.net/logout
        DOM1__REDIRECTURI: https://admin.hearings.reform.hmcts.net/home
        VHSERVICES__BOOKINGSAPIURL: https://vh-bookings-api.platform.hmcts.net/
        VHSERVICES__NOTIFICATIONAPIURL: https://vh-notification-api.platform.hmcts.net/
        VHSERVICES__USERAPIURL: https://vh-user-api.platform.hmcts.net/
        VHSERVICES__VIDEOAPIURL: https://vh-video-api.platform.hmcts.net/
        VHSERVICES__VIDEOWEBURL: https://video.hearings.reform.hmcts.net/
      image: sdshmctspublic.azurecr.io/vh/admin-web:prod-67ad08e-202402071717
      ingressHost: admin.hearings.reform.hmcts.net
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-booking-queue-subscriber
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-booking-queue-subscriber/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-booking-queue-subscriber
  upgrade:
    disableWait: true
  values:
    function:
      object:
        cooldownPeriod: 600
        idleReplicaCount: 1
        maxReplicaCount: 2
        minReplicaCount: 1
        pollingInterval: 10
      triggerAuth:
        triggerPodIdentityProvider: azure-workload
      triggers:
        - messageCount: 1
          queueName: booking
          serviceBusName: vh-infra-core-prod
          type: azure-servicebus
    java:
      disableTraefikTls: true
      environment:
        VHSERVICES__BOOKINGSAPIURL: https://vh-bookings-api.platform.hmcts.net/
        VHSERVICES__NOTIFICATIONAPIURL: https://vh-notification-api.platform.hmcts.net/
        VHSERVICES__USERAPIURL: https://vh-user-api.platform.hmcts.net/
        VHSERVICES__VIDEOAPIURL: https://vh-video-api.platform.hmcts.net/
        VHSERVICES__VIDEOWEBURL: https://video.hearings.reform.hmcts.net/
      image: sdshmctspublic.azurecr.io/vh/booking-queue-subscriber:prod-1b6c12e-202402071714
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-bookings-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-bookings-api/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-bookings-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/bookings-api:prod-61d01a4-202402071717
      ingressHost: vh-bookings-api.platform.hmcts.net
      replicas: 2
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-notification-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-notification-api/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-notification-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/notification-api:prod-3b62151-202402071718
      ingressHost: vh-notification-api.platform.hmcts.net
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-user-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-user-api/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-user-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/user-api:prod-89099c1-202311141719
      ingressHost: vh-user-api.platform.hmcts.net
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-video-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-video-api/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-video-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      environment:
        KINLYCONFIGURATION__CALLBACKURI: https://video.hearings.reform.hmcts.net/callback
        SERVICES__CALLBACKURI: https://video.hearings.reform.hmcts.net/callback
      image: sdshmctspublic.azurecr.io/vh/video-api:prod-ceca202-202402071722
      ingressHost: vh-video-api.platform.hmcts.net
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-video-web
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-video-web/prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-video-web
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      environment:
        AZUREAD__POSTLOGOUTREDIRECTURI: https://video.hearings.reform.hmcts.net/logout
        AZUREAD__REDIRECTURI: https://video.hearings.reform.hmcts.net/home
        DOM1__POSTLOGOUTREDIRECTURI: https://video.hearings.reform.hmcts.net/logout
        DOM1__REDIRECTURI: https://video.hearings.reform.hmcts.net/home
        EJUDAD__POSTLOGOUTREDIRECTURI: https://video.hearings.reform.hmcts.net/logout
        EJUDAD__REDIRECTURI: https://video.hearings.reform.hmcts.net/home
        VHSERVICES__BOOKINGSAPIURL: https://vh-bookings-api.platform.hmcts.net/
        VHSERVICES__USERAPIURL: https://vh-user-api.platform.hmcts.net/
        VHSERVICES__VIDEOAPIURL: https://vh-video-api.platform.hmcts.net/
      image: sdshmctspublic.azurecr.io/vh/video-web:prod-cea087d-202402071717
      ingressHost: video.hearings.reform.hmcts.net
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-admin-web
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-admin-web/non-prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-admin-web
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/admin-web:prod-67ad08e-202402071717
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-bookings-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-bookings-api/non-prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-bookings-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/bookings-api:prod-61d01a4-202402071717
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-notification-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-notification-api/non-prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-notification-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/notification-api:prod-3b62151-202402071718
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-user-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-user-api/non-prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-user-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/user-api:prod-89099c1-202311141719
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-video-api
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-video-api/non-prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-video-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/video-api:prod-ceca202-202402071722
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: vh-video-web
  namespace: vh
spec:
  chart:
    spec:
      chart: ./stable/vh-video-web/non-prod
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  interval: 10m
  releaseName: vh-video-web
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/vh/video-web:prod-cea087d-202402071717
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: lgy-iac-web
  namespace: dts-legacy
spec:
  chart:
    spec:
      chart: ./stable/lgy-iac-web
      interval: 8m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  releaseName: lgy-iac-web
  values:
    java:
      image: sdshmctspublic.azurecr.io/lgy-iac/web:prod-503f6e9-20220923094351
      replicas: 1
      useInterpodAntiAffinity: true
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: my-time-api
  namespace: my-time
spec:
  chart:
    spec:
      chart: ./stable/my-time-api
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  releaseName: my-time-api
  upgrade:
    disableWait: true
  values:
    java:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/my-time/api:prod-564a3ad-20230411113310
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: my-time-frontend
  namespace: my-time
spec:
  chart:
    spec:
      chart: ./stable/my-time-frontend
      interval: 5m
      sourceRef:
        kind: GitRepository
        name: hmcts-charts
        namespace: flux-system
  install:
    disableWait: true
  releaseName: my-time-frontend
  upgrade:
    disableWait: true
  values:
    nodejs:
      disableTraefikTls: true
      image: sdshmctspublic.azurecr.io/my-time/frontend:latest
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: themis-fe
  namespace: met
spec:
  chart:
    spec:
      chart: ./charts/met
      interval: 1m
      sourceRef:
        kind: GitRepository
        name: sds-helm-charts
        namespace: flux-system
  interval: 5m
  releaseName: met-themis-fe
  values:
    nodejs:
      applicationPort: 8082
      autoscaling:
        enabled: true
        maxReplicas: 8
        targetCPUUtilizationPercentage: 80
      cpuLimits: 1000m
      cpuRequests: 50m
      environment:
        CONFISCATION_SCHEMAS: 110,45,97,116,66,109,107,113
        DAC_KEY_EXPIRE_TIME_SECONDS: 300
        DAC_NUMBER_OF_INSTANCES: 13
        KV_CONFIG_TREE: /mnt/secrets/libragob-prod-kv/
        LOG4J_DEBUG: true
        LOGGING_LEVEL_ROOT: DEBUG
        MAINTENANCE_SCHEMAS: 111,67,44
        SPRING_JMS_SERVICEBUS_IDLE-timeout: 30000
        SPRING_JMS_SERVICEBUS_PRICING-TIER: PREMIUM
        TEMP_VAR: 1
        THEMIS_DAC_LISTENERQUEUENAME: LIBRAGOB_WRITERQUEUE
        THEMIS_DAC_LISTENERSENDERID: Themis_GW
        THEMIS_DAC_RESEND_COOLDOWN_IN_SECONDS: 30
        THEMIS_DAC_WRITERQUEUENAME: LIBRAGOB_READERQUEUE
        THEMIS_GATEWAY_CONNECTIONTIMEOUT: 720000
        THEMIS_GATEWAY_HOLDERCLEANUPCRON: 0 0,30 * * * ?
        THEMIS_GATEWAY_JKSLOCATION: /opt/jks/ThemisAzureKeyStore.jks
        THEMIS_GATEWAY_LISTENERQUEUENAME: LIBRAGOB_READERQUEUE
        THEMIS_GATEWAY_LISTENERSENDERID: Themis_DAC
        THEMIS_GATEWAY_MESSAGEAUDITSUPPRESSION: "OFF"
        THEMIS_GATEWAY_PERSISTMESSAGEAUDITCONTENTFORNONUIFLOW: true
        THEMIS_GATEWAY_RECEIVETIMEOUT: 720000
        THEMIS_GATEWAY_RESPONSESMAXCONCURRENTPROCESSED: 20
        THEMIS_GATEWAY_WRITERQUEUENAME: LIBRAGOB_WRITERQUEUE
        THEMIS_GATEWAY_WRITERSENDERID: Themis_GW
        UPDATES_FIXEDRATE_IN_MILLISECONDS: 2000
        logging_level_root: DEBUG
        updates_fixedRate_in_milliseconds: 2000
      image: sdshmctspublic.azurecr.io/themis/themis_sb_azure:1.0.10
      ingressHost: cloudgobgateway.platform.hmcts.net
      keyVaults:
        libragob-prod-kv:
          excludeEnvironmentSuffix: true
          secrets:
            - themis-gateway-keystorebase64
            - themis-gateway-dbpassword
            - themis-gateway-dbusername
            - themis-gateway-datasourceurl
            - dac-datasource-password
            - dac-datasource-username
            - dac-datasource-url
            - event-datasource-password
            - event-datasource-username
            - event-datasource-url
            - fines-datasource-password
            - fines-datasource-username
            - fines-datasource-url
            - maintenance-datasource-password
            - maintenance-datasource-username
            - maintenance-datasource-url
            - confiscation-datasource-password
            - confiscation-datasource-username
            - confiscation-datasource-url
            - servicebus-connectionstring
      livenessDelay: 90
      livenessPath: /services/themisgatewayapi?wsdl
      memoryLimits: 3072Mi
      memoryRequests: 2560Mi
      readinessPath: /services/themisgatewayapi?wsdl
      replicas: 4
      startupDelay: 90
      startupPath: /services/themisgatewayapi?wsdl
    podLabels:
      aadpodidbinding: met-schema-binding
