apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
bases:
- ../../../release/admin/secrets-csi-driver
- ../../../namespaces/admin/traefik2
- ../../../namespaces/azure-devops
- ../../../namespaces/admin/aad-pod-identity
- ../../../namespaces/kube-system/aad-pod-identity
- ../../../namespaces/neuvector
- ../../../namespaces/monitoring/kube-prometheus-stack

patches:
- path: ../prod-helmrelease.yaml
  target:
    kind: HelmRelease

patchesStrategicMerge:
#traefik patch
- ../../../namespaces/admin/traefik2/patches/prod/secret-provider.yaml
- ../../../namespaces/admin/traefik2/patches/prod/cluster-00/traefik2.yaml

#azure-devops-agent patch
- ../../../namespaces/azure-devops/azure-devops-agent/patches/prod/cluster-00/azure-devops-agent.yaml

#neuvector patch
- ../../../namespaces/neuvector/patches/prod/neuvector.yaml
- ../../../namespaces/neuvector/patches/prod/cluster-00/neuvector.yaml

# prom-operator patch
- ../../../namespaces/monitoring/kube-prometheus-stack/patches/prod/cluster-00/kube-prometheus-stack.yaml
- ../../../namespaces/monitoring/kube-prometheus-stack/patches/prod/cluster-00/mailrelay-alerts-rules.yaml
