---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: vh-user-api-dev
  namespace: vh
  annotations:
    flux.weave.works/automated: "true"
    flux.weave.works/tag.chart-image: master-*
spec:
  releaseName: vh-user-api
  chart:
    git: git@github.com:hmcts/shared-services-flux
    path: k8s/release/vh/vh-user-api
    ref: master
  values:
    replicas: 2
    image: 
      repository: sdshmctspublic.azurecr.io/vh/vh-user-api
      tag: "v0.1"
      pullPolicy: Always
    service:
      type: ClusterIP
      port: 80
    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik-dev
      paths:
      - /
      tls: []
      hosts:
      - 'vh-user-api-dev.hearings.reform.hmcts.net'
    keyvaults:
    - name: vhinfracorehtdev
      resourcegroup: vh-infra-core-dev
      subscriptionid: 867a878b-cb68-4de5-9741-361ac9e178b6
      tenantid: 531ff96d-0ae9-462a-8d2d-bec7c0b42082
      secretref: kvcreds
      secrets:
      - TenantId
      - vh-user-api-key
      - vh-user-api-appid
      - vh-user-api-identifieruris
      - vh-infra-core-AppInsightsKey
    env:
      - name: "AdGroup:Administrator"
        value: "VirtualRoomAdministrator"
      - name: "AdGroup:CaseType"
        value: "CaseType"
      - name: "AdGroup:External"
        value: "External"
      - name: "AdGroup:Judge"
        value: "VirtualRoomJudge"
      - name: "AdGroup:JudgesTestGroup"
        value: "TestAccount"
      - name: "AdGroup:ProfessionalUser"
        value: "VirtualRoomProfessionalUser"
      - name: "APPINSIGHTS_PROFILERFEATURE_VERSION"
        value: "disabled"
      - name: "APPINSIGHTS_SNAPSHOTFEATURE_VERSION"
        value: "disabled"
      - name: "ApplicationInsights_InstrumentationKey"
        value: "<azure-secret:vh-infra-core-AppInsightsKey>"
      - name: "APPLICATIONINSIGHTS_CONNECTION_STRING"
        value: "InstrumentationKey=<azure-secret:vh-infra-core-AppInsightsKey>"
      - name: "ApplicationInsightsAgent_EXTENSION_VERSION"
        value: "~2"
      - name: "AzureAd_ClientSecret"
        value: "<azure-secret:vh-user-api-key>"
      - name: "AzureAd_ClientId"
        value: "<azure-secret:vh-user-api-appid>"
      - name: "AzureAd_TenantId"
        value: "<azure-secret:TenantId>"
      - name: "AzureAd_VhUserApiResourceId"
        value: "<azure-secret:vh-user-api-identifieruris>"
      - name: "ConnectionStrings:RedisCache"
        value: "<azure-secret:redis-connection-str>"
      - name: "DefaultPassword"
        value: "<azure-secret:defaultpassword"
      - name: "DiagnosticServices_EXTENSION_VERSION" 
        value: "disabled"
      - name: "InstrumentationEngine_EXTENSION_VERSION"
        value: "disabled"
      - name: "IsLive"
        value: "False"
      - name: "MSDEPLOY_RENAME_LOCKED_FILES" 
        value: "1"
      - name: "ReformEmail"
        value: "hearings.reform.hmcts.net"
      - name: "SnapshotDebugger_EXTENSION_VERSION"
        value: "disabled"
      - name: "TestDefaultPassword"
        value: "<azure-secret:testdefaultpassword>"
      - name: "Testing:ExistingEmail"
        value: "UserApiTestUser@a.com"
      - name: "Testing:ExistingGroups:0:Displayname"
        value: "External"
      - name: "Testing:ExistingGroups:0:GroupId"
        value: "121fa058-1796-4531-a9ee-63be1d4dc630"
      - name: "Testing:ExistingGroups:1:Displayname"
        value: "UserApiTestGroup"
      - name: "Testing:ExistingGroups:1:GroupId"
        value: "371ac75b-22b1-48d8-a3d8-f0587604d01f"
      - name: "Testing:ExistingUserDisplayname"
        value: "User Api Test User"
      - name: "Testing:ExistingUserFirstname" 
        value: "User"
      - name: "Testing:ExistingUserId" 
        value: "948cb183-00cf-4251-8b13-6c39a1b0c25d"
      - name: "Testing:ExistingUserLastname"
        value: "Api"
      - name: "Testing:ExistingUserPrincipal"
        value: "UserApiTestUser@hearings.reform.hmcts.net"
      - name: "Testing:NewGroups:0:Displayname" 
        value: "NewUserApiTestGroup"
      - name: "Testing:NewGroups:0:GroupId"
        value: "7d62cf17-c548-4a69-8f8f-4bc7fee90fbe"
      - name: "VhServices:UserApiResourceId"
        value: "https://vh-user-api-dev.azurewebsites.net"
      - name: "VhServices:UserApiUrl" 
        value: "https://vh-user-api-dev-staging.azurewebsites.net/"
      - name: "XDT_MicrosoftApplicationInsights_BaseExtensions"
        value: "disabled"
      - name: "XDT_MicrosoftApplicationInsights_Mode"
        value: "default"
      - name: "ZapConfiguration:BuildConfigMode"
        value: "Release"