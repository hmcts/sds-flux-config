---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: vh-user-api-dev
  namespace: vh
  annotations:
    flux.weave.works/automated: "true"
    flux.weave.works/tag.chart-image: master-*
spec:
  releaseName: vh-user-api
  chart:
    git: git@github.com:hmcts/shared-services-flux
    path: k8s/release/vh/vh-user-api
    ref: master
  values:
    replicas: 2
    image: 
      repository: sdshmctspublic.azurecr.io/vh/vh-user-api
      tag: "v0.1"
      pullPolicy: Always
    service:
      type: ClusterIP
      port: 80
    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: traefik
      paths:
      - /
      tls: []
      hosts:
      - 'vh-user-api-dev.hearings.reform.hmcts.net'
    keyvaults:
    - name: vhinfracorehtdev
      resourcegroup: vh-infra-core-dev
      subscriptionid: 867a878b-cb68-4de5-9741-361ac9e178b6
      tenantid: 531ff96d-0ae9-462a-8d2d-bec7c0b42082
      secretref: kvcreds
      secrets:
      - TenantId
      - vh-user-api-key
      - vh-user-api-appid
      - vh-user-api-identifieruris
      - vh-infra-core-AppInsightsKey
    appsettings:
      AdGroup:Administrator: VirtualRoomAdministrator
      AdGroup:CaseType: CaseType
      AdGroup:External: External
      AdGroup:Judge: VirtualRoomJudge
      AdGroup:JudgesTestGroup: TestAccount
      AdGroup:ProfessionalUser: VirtualRoomProfessionalUser
      APPINSIGHTS_PROFILERFEATURE_VERSION: disabled
      APPINSIGHTS_SNAPSHOTFEATURE_VERSION: disabled
      ApplicationInsights_InstrumentationKey: <azure-secret:vh-infra-core-AppInsightsKey>
      APPLICATIONINSIGHTS_CONNECTION_STRING: InstrumentationKey=<azure-secret:vh-infra-core-AppInsightsKey>
      ApplicationInsightsAgent_EXTENSION_VERSION: ~2
      AzureAd_ClientSecret: <azure-secret:vh-user-api-key>
      AzureAd_ClientId: <azure-secret:vh-user-api-appid>
      AzureAd_TenantId: <azure-secret:TenantId>
      AzureAd_VhUserApiResourceId: <azure-secret:vh-user-api-identifieruris>
      ConnectionStrings:RedisCache: <azure-secret:redis-connection-str>
      DefaultPassword: <azure-secret:defaultpassword>
      DiagnosticServices_EXTENSION_VERSION: disabled
      InstrumentationEngine_EXTENSION_VERSION: disabled
      IsLive: False
      MSDEPLOY_RENAME_LOCKED_FILES: 1
      ReformEmail: hearings.reform.hmcts.net
      SnapshotDebugger_EXTENSION_VERSION: disabled
      TestDefaultPassword: <azure-secret:testdefaultpassword>
      Testing:ExistingEmail: UserApiTestUser@a.com
      Testing:ExistingGroups:0:Displayname: External
      Testing:ExistingGroups:0:GroupId: 121fa058-1796-4531-a9ee-63be1d4dc630
      Testing:ExistingGroups:1:Displayname: UserApiTestGroup
      Testing:ExistingGroups:1:GroupId: 371ac75b-22b1-48d8-a3d8-f0587604d01f
      Testing:ExistingUserDisplayname: User Api Test User
      Testing:ExistingUserFirstname: User
      Testing:ExistingUserId: 948cb183-00cf-4251-8b13-6c39a1b0c25d
      Testing:ExistingUserLastname: Api
      Testing:ExistingUserPrincipal: UserApiTestUser@hearings.reform.hmcts.net
      Testing:NewGroups:0:Displayname: NewUserApiTestGroup
      Testing:NewGroups:0:GroupId: 7d62cf17-c548-4a69-8f8f-4bc7fee90fbe
      VhServices:UserApiResourceId: https://vh-user-api-dev.azurewebsites.net
      VhServices:UserApiUrl: https://vh-user-api-dev-staging.azurewebsites.net/
      XDT_MicrosoftApplicationInsights_BaseExtensions: disabled
      XDT_MicrosoftApplicationInsights_Mode: default
      ZapConfiguration:BuildConfigMode: Release

