apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
bases:
- ../../../release/admin/kube-slack
- ../../../release/admin/kured
- ../../../release/admin/secrets-csi-driver
- ../../../release/mailrelay/mailrelay
- ../../../release/mailrelay/mailrelay2
- ../../../namespaces/admin/traefik2
#- ../../../namespaces/azure-devops
- ../../../namespaces/admin/aad-pod-identity
- ../../../namespaces/kube-system/aad-pod-identity
- ../../../namespaces/monitoring/kube-prometheus-stack
# - ../../../release/admin/env-injector
# - ../../../release/kube-system/nodelocaldns

patches:
- path: ../dev-helmrelease.yaml
  target:
    kind: HelmRelease

patchesStrategicMerge:

#traefik patch
- ../../../namespaces/admin/traefik2/patches/dev/secret-provider.yaml
- ../../../namespaces/admin/traefik2/patches/dev/cluster-01/traefik2.yaml

#kube-slack patch
- ../../../release/admin/kube-slack/patches/dev/cluster-01/kube-slack.yaml


#kured patch
- ../../../release/admin/kured/patches/dev/cluster-01/kured.yaml

#azure-devops-agent patch
#- ../../../namespaces/azure-devops/azure-devops-agent/patches/dev/cluster-00/azure-devops-agent.yaml

# env-injector
# - ../../../release/admin/env-injector/patches/dev/cluster-00/env-injector.yaml

# mail-relay
- ../../../release/mailrelay/mailrelay/patches/dev/cluster-01/mailrelay.yaml
- ../../../release/mailrelay/mailrelay2/patches/dev/cluster-01/mailrelay2.yaml

# prom-operator patch
- ../../../namespaces/monitoring/kube-prometheus-stack/patches/dev/cluster-01/kube-prometheus-stack.yaml
- ../../../namespaces/monitoring/kube-prometheus-stack/patches/dev/cluster-01/mailrelay-alerts-rules.yaml
- ../../../namespaces/monitoring/kube-prometheus-stack/patches/dev/cluster-01/mailrelay2-alerts-rules.yaml